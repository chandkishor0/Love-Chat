<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Love Chat</title>
<link rel="stylesheet" href="style.css" />
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  /* Mini Sparkles */
  .sparkle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    animation: sparkleMove 0.5s ease-out forwards; /* 0.5s duration */
    z-index: 50;
  }
  @keyframes sparkleMove {
    0% { opacity:1; transform: translate(0,0) scale(1); }
    50% { opacity:0.8; transform: translate(var(--x), var(--y)) scale(var(--scale,1.3)); }
    100% { opacity:0; transform: translate(var(--x), var(--y)) scale(0); }
  }

  /* Glow trail */
  .glowTrail {
    position: absolute;
    inset: -6px;
    border-radius: 50%;
    background: conic-gradient(#ff69b4,#00ffff,#ffdc00,#ff4500,#7cfc00,#ff69b4);
    filter: blur(8px);
    opacity: 0.8;
    z-index: -1;
    pointer-events: none;
    animation: rotateTrail 0.5s linear infinite; /* 0.5s duration */
  }
  @keyframes rotateTrail {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Buttons positioning */
  #logoutBtn {
    position: absolute;
    top: 8px;
    right: 8px;
    z-index: 10;
  }
  #sendBtn {
    position: absolute;
    right: 8px;
    top: 45%; /* slightly up */
    transform: translateY(-50%);
    z-index: 10;
    width: 32px;
    height: 32px;
    padding: 0;
  }

  .chatInputWrapper {
    position: relative;
    width: 100%;
    margin-top: 8px;
  }

  /* Adjust SVG inside smaller button */
  #sendBtn svg {
    width: 18px;
    height: 18px;
  }
</style>
</head>
<body class="theme-pink">

<div class="container">

  <div id="authBox">
    <h2>Login / Signup</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Login</button>
    <p id="authMsg" style="color:red"></p>
  </div>

  <div id="partnerBox" style="display:none;">
    <h2>Enter Partner Details</h2>
    <input type="email" id="partnerEmail" placeholder="Partner Email" />
    <input type="text" id="partnerSecretCode" placeholder="Partner Secret Code" />
    <p>Your Secret Code: <b id="mySecretCode"></b></p>
    <button onclick="setPartner()">Start Chat</button>
  </div>

  <div id="chatBoxContainer" style="display:none;">
    <div class="chatHeader" style="position: relative;">
      <span id="partnerName">Partner Chat</span>
      <button id="logoutBtn" class="neonButton" onclick="logout()" aria-label="Logout" title="Logout">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
      </button>
    </div>

    <p id="codeDisplay"></p>
    <div id="chatBox"></div>
    <div id="typingIndicator"></div>

    <div class="chatInputWrapper">
      <input type="text" id="messageInput" placeholder="Type your message..." />
      <button id="sendBtn" class="neonButton" onclick="sendMessage()" title="Send">
        <svg viewBox="0 0 24 24">
          <path d="M22 2L11 13"></path>
          <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
        </svg>
      </button>
    </div>

    <div class="chatThemeWrapper">
      <button onclick="toggleTheme()">Change Theme</button>
    </div>
  </div>

</div>

<script src="app.js"></script>

<script>
  const logoutBtn = document.querySelector('#logoutBtn');
  const sendBtn = document.querySelector('#sendBtn');

  function speedUpNeon(element, multiplier=3, duration=500){ // 0.5s
    const computed = window.getComputedStyle(element);
    const currentDur = computed.getPropertyValue('animation-duration');
    if(!currentDur) return;
    const ms = currentDur.includes('s') ? parseFloat(currentDur)*1000 : parseFloat(currentDur);
    element.style.animationDuration = (ms/multiplier) + 'ms';
    setTimeout(()=>{ element.style.animationDuration = currentDur; }, duration);
  }

  function createSparkles(button){
    const colors = ['#ff69b4','#00ffff','#ffdc00','#ff4500','#7cfc00'];
    for(let i=0;i<8;i++){
      const sparkle = document.createElement('div');
      sparkle.classList.add('sparkle');
      const size = Math.random()*6 + 4;
      sparkle.style.width = size+'px';
      sparkle.style.height = size+'px';
      sparkle.style.background = colors[Math.floor(Math.random()*colors.length)];
      const x = (Math.random()*100-50)+'px';
      const y = (Math.random()*-100-30)+'px';
      sparkle.style.setProperty('--x', x);
      sparkle.style.setProperty('--y', y);
      sparkle.style.setProperty('--scale', (Math.random()*0.5+1));
      button.appendChild(sparkle);
      setTimeout(()=> sparkle.remove(), 500);
    }
  }

  function addGlowTrail(button){
    const trail = document.createElement('div');
    trail.classList.add('glowTrail');
    button.appendChild(trail);
    setTimeout(()=> trail.remove(), 500);
  }

  function onButtonTap(btn){
    speedUpNeon(btn,3,500);
    createSparkles(btn);
    addGlowTrail(btn);
  }

  logoutBtn.addEventListener('click', ()=> onButtonTap(logoutBtn));
  sendBtn.addEventListener('click', ()=> onButtonTap(sendBtn));
</script>

</body>
</html>
